{% extends 'base.html' %}

{% block title %}All Activities - Academic Achievement Summarizer{% endblock %}

{% block page_title %}All Activities{% endblock %}

{% block extra_css %}
<style>
    .filter-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    .filter-group {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .filter-group label {
        font-weight: 500;
        color: #666;
    }
    .search-box {
        flex: 1;
        min-width: 200px;
    }
    .search-box input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .entries-container {
        max-height: 65vh;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        padding-right: 15px;
    }
    .entry-card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 12px 15px;
        margin-bottom: 10px;
    }
    .entry-card:hover {
        background: #f8f9fa;
    }
    .entry-card.manual {
        border-left: 4px solid #3498db;
    }
    .entry-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    .entry-faculty {
        font-weight: bold;
        color: #2c3e50;
    }
    .entry-badges {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
    }
    .badge {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 3px;
    }
    .badge-category {
        background: #34495e;
        color: white;
    }
    .badge-subcategory {
        background: #7f8c8d;
        color: white;
    }
    .badge-survey {
        background: #e8f4f8;
        color: #2980b9;
    }
    .badge-manual {
        background: #e8f8e8;
        color: #27ae60;
    }
    .entry-content {
        font-size: 14px;
        color: #444;
    }
    .entry-content .field {
        margin-bottom: 3px;
    }
    .entry-content .field-label {
        font-weight: 500;
        color: #666;
    }
    .summary-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    .results-count {
        font-size: 14px;
        color: #666;
    }
</style>
{% endblock %}

{% block content %}
<p><a href="{% url 'activity_categories' %}?year={{ academic_year.year_code }}">Back to Browse Activities</a></p>

<form method="get" class="filter-bar">
    <div class="filter-group">
        <label>Year:</label>
        <select name="year" onchange="this.form.submit()">
            {% for year in years %}
            <option value="{{ year.year_code }}" {% if year.year_code == academic_year.year_code %}selected{% endif %}>
                AY {{ year.year_code }}{% if year.is_current %} (Current){% endif %}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-group">
        <label>Category:</label>
        <select name="category" onchange="this.form.submit()">
            <option value="">All Categories</option>
            {% for key, name in category_choices %}
            <option value="{{ key }}" {% if key == category_filter %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-group">
        <label>Source:</label>
        <select name="source" onchange="this.form.submit()">
            <option value="">All Sources</option>
            <option value="survey" {% if source_filter == 'survey' %}selected{% endif %}>Survey Only</option>
            <option value="manual" {% if source_filter == 'manual' %}selected{% endif %}>Manual Only</option>
        </select>
    </div>

    <div class="search-box">
        <input type="text" name="q" value="{{ search_query }}" placeholder="Search activities...">
    </div>

    <button type="submit" class="btn btn-app">Search</button>
    {% if category_filter or source_filter or search_query %}
    <a href="{% url 'all_activities' %}?year={{ academic_year.year_code }}" class="btn btn-secondary">Clear</a>
    {% endif %}
</form>

<div class="summary-bar">
    <span class="results-count">
        <strong>{{ entries|length }}</strong> activities found
        {% if category_filter or source_filter or search_query %}(filtered){% endif %}
    </span>
</div>

<div class="entries-container">
{% if entries %}
    {% for entry in entries %}
    <div class="entry-card {% if entry.source == 'Manual' %}manual{% endif %}">
        <div class="entry-header">
            <span class="entry-faculty">
                <a href="{% url 'faculty_activities' entry.faculty_email %}?year={{ academic_year.year_code }}">
                    {{ entry.faculty_name }}
                </a>
            </span>
            <div class="entry-badges">
                <span class="badge badge-category">{{ entry.category_name }}</span>
                <span class="badge badge-subcategory">{{ entry.subcategory_name }}</span>
                <span class="badge {% if entry.source == 'Manual' %}badge-manual{% else %}badge-survey{% endif %}">
                    {{ entry.source }}
                </span>
            </div>
        </div>
        <div class="entry-content">
            {% for key, value in entry.data.items %}
                {% if key != 'source' and key != 'added_at' and key != 'edited_at' and key != 'points' and value %}
                <div class="field">
                    <span class="field-label">{{ key|title }}:</span> {{ value }}
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}
{% else %}
    <div style="text-align: center; padding: 40px; color: #666;">
        {% if category_filter or source_filter or search_query %}
            No activities match your filters. <a href="{% url 'all_activities' %}?year={{ academic_year.year_code }}">Clear filters</a>
        {% else %}
            No activities found for this academic year.
        {% endif %}
    </div>
{% endif %}
</div>
{% endblock %}
