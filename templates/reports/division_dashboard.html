{% extends 'base.html' %}

{% block title %}{{ division.name }} Division - Dashboard{% endblock %}

{% block page_title %}{{ division.name }} Division{% endblock %}

{% block extra_css %}
<style>
    .summary-stats {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
    }
    .stat-card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px 25px;
        text-align: center;
    }
    .stat-value {
        font-size: 28px;
        font-weight: bold;
        color: #2c3e50;
    }
    .stat-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
    }
    .summary-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }
    .summary-table th {
        background: #34495e;
        color: white;
        padding: 10px 8px;
        text-align: center;
        font-weight: 500;
        position: sticky;
        top: 0;
    }
    .summary-table th:first-child {
        text-align: left;
    }
    .summary-table td {
        padding: 8px;
        border-bottom: 1px solid #eee;
        text-align: center;
    }
    .summary-table td:first-child {
        text-align: left;
    }
    .summary-table tr:hover {
        background: #f8f9fa;
    }
    .points-cell {
        font-weight: 500;
    }
    .points-cell.zero {
        color: #ccc;
    }
    .points-cell.has-value {
        color: #27ae60;
    }
    .total-cell {
        font-weight: 700;
        font-size: 14px;
        color: #2c3e50;
    }
    .quarter-badge {
        display: inline-block;
        width: 22px;
        height: 22px;
        line-height: 22px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
        text-align: center;
        margin-right: 2px;
    }
    .quarter-badge.submitted {
        background: #28a745;
        color: white;
    }
    .quarter-badge.pending {
        background: #e9ecef;
        color: #999;
    }
    .quarter-badge.in_progress {
        background: #ffc107;
        color: #333;
    }
    .avc-badge {
        background: #28a745;
        color: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 10px;
    }
    .avc-badge.not-eligible {
        background: #dc3545;
    }
    .faculty-link {
        color: #3498db;
        text-decoration: none;
        font-weight: 500;
    }
    .faculty-link:hover {
        text-decoration: underline;
    }
    .table-container {
        overflow-x: auto;
        border: 1px solid #dee2e6;
        border-radius: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <p class="text-muted mb-0">
            {% if division.chief %}
            Division Chief: <strong>{{ division.chief.display_name }}</strong>
            {% else %}
            <span class="text-warning">No division chief assigned</span>
            {% endif %}
        </p>
    </div>
    <a href="{% url 'divisions_list' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> All Divisions
    </a>
</div>

<div class="summary-stats">
    <div class="stat-card">
        <div class="stat-value">{{ total_faculty }}</div>
        <div class="stat-label">Faculty</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ faculty_with_data }}</div>
        <div class="stat-label">With Data</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ avc_eligible_count }}</div>
        <div class="stat-label">AVC Eligible</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">AY {{ academic_year.year_code }}</div>
        <div class="stat-label">Academic Year</div>
    </div>
</div>

<div class="table-container">
    <table class="summary-table">
        <thead>
            <tr>
                <th style="min-width: 180px;">Faculty</th>
                <th style="width: 60px;">AVC</th>
                <th style="width: 100px;">Quarters</th>
                <th style="width: 80px;">Citizenship</th>
                <th style="width: 80px;">Education</th>
                <th style="width: 80px;">Research</th>
                <th style="width: 80px;">Leadership</th>
                <th style="width: 80px;">Content</th>
                <th style="width: 80px;">Dept</th>
                <th style="width: 90px;">Total</th>
                <th style="width: 50px;">View</th>
            </tr>
        </thead>
        <tbody>
            {% for item in summary_data %}
            <tr>
                <td>
                    <a href="{% url 'faculty_annual_view' item.faculty.email %}" class="faculty-link">
                        {{ item.faculty.display_name }}
                    </a>
                </td>
                <td>
                    {% if item.faculty.is_avc_eligible %}
                    <span class="avc-badge">Yes</span>
                    {% else %}
                    <span class="avc-badge not-eligible">No</span>
                    {% endif %}
                </td>
                <td>
                    {% for q in item.quarters %}
                    <span class="quarter-badge {{ q.status }}" title="{{ q.quarter }}: {{ q.status }}">
                        {{ q.quarter|slice:":2" }}
                    </span>
                    {% empty %}
                    <span class="text-muted">-</span>
                    {% endfor %}
                </td>
                <td class="points-cell {% if item.citizenship %}has-value{% else %}zero{% endif %}">
                    {{ item.citizenship|default:"-" }}
                </td>
                <td class="points-cell {% if item.education %}has-value{% else %}zero{% endif %}">
                    {{ item.education|default:"-" }}
                </td>
                <td class="points-cell {% if item.research %}has-value{% else %}zero{% endif %}">
                    {{ item.research|default:"-" }}
                </td>
                <td class="points-cell {% if item.leadership %}has-value{% else %}zero{% endif %}">
                    {{ item.leadership|default:"-" }}
                </td>
                <td class="points-cell {% if item.content_expert %}has-value{% else %}zero{% endif %}">
                    {{ item.content_expert|default:"-" }}
                </td>
                <td class="points-cell {% if item.dept_total %}has-value{% else %}zero{% endif %}">
                    {{ item.dept_total|default:"-" }}
                </td>
                <td class="total-cell">
                    {{ item.grand_total }}
                </td>
                <td>
                    {% if item.quarters_submitted > 0 %}
                    <a href="{% url 'faculty_annual_view' item.faculty.email %}" class="text-muted" title="View Annual Summary">
                        <i class="bi bi-calendar-range"></i>
                    </a>
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="11" class="text-center text-muted py-4">
                    No faculty in this division.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-4 d-flex justify-content-end">
    <button onclick="window.print()" class="btn btn-outline-secondary">
        <i class="bi bi-printer"></i> Print
    </button>
</div>

<style>
@media print {
    .btn, nav, .navbar { display: none !important; }
}
</style>
{% endblock %}
