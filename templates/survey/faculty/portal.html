<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Survey Portal - UNMC Anesthesiology</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        .portal-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .portal-header {
            background: white;
            border-radius: 16px 16px 0 0;
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #0d6efd;
        }
        .portal-body {
            background: white;
            padding: 30px;
        }
        .portal-footer {
            background: #f8f9fa;
            border-radius: 0 0 16px 16px;
            padding: 20px 30px;
            text-align: center;
        }
        .points-display {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 25px;
        }
        .points-value {
            font-size: 3rem;
            font-weight: bold;
        }
        .current-survey-card {
            border: 2px solid #0d6efd;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            background: #f0f7ff;
        }
        .past-survey-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .past-survey-item:last-child {
            border-bottom: none;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-submitted {
            background: #d4edda;
            color: #155724;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-in_progress {
            background: #cce5ff;
            color: #004085;
        }
    </style>
</head>
<body>
    <div class="portal-container">
        <div class="portal-header">
            <h2 class="mb-1"><i class="bi bi-person-circle"></i> My Survey Portal</h2>
            <h4 class="text-muted mb-0">{{ faculty.display_name }}</h4>
        </div>

        <div class="portal-body">
            <!-- Points Summary -->
            <div class="points-display">
                <div class="points-value">{{ total_points }}</div>
                <div>Total Points - AY {{ academic_year.year_code }}</div>
            </div>

            <!-- Current Survey -->
            {% if current_campaign %}
            <div class="current-survey-card">
                <h5 class="mb-3">
                    <i class="bi bi-clipboard-check text-primary"></i>
                    Current Survey: {{ current_campaign.name }}
                </h5>

                {% if current_invitation %}
                    {% if current_invitation.status == 'submitted' %}
                    <div class="alert alert-success mb-3">
                        <i class="bi bi-check-circle"></i>
                        <strong>Submitted</strong> on {{ current_invitation.submitted_at|date:"M j, Y" }}
                        - You can still make changes until {{ current_campaign.closes_at|date:"M j, Y" }}
                    </div>
                    {% elif current_invitation.status == 'in_progress' %}
                    <div class="alert alert-info mb-3">
                        <i class="bi bi-pencil"></i>
                        <strong>In Progress</strong> - Continue where you left off
                    </div>
                    {% else %}
                    <div class="alert alert-warning mb-3">
                        <i class="bi bi-hourglass"></i>
                        <strong>Not Started</strong> - Begin your survey below
                    </div>
                    {% endif %}

                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted">Deadline: {{ current_campaign.closes_at|date:"l, F j, Y" }}</small>
                            {% if current_response %}
                            <br><small class="text-muted">Points this quarter: {{ current_response.total_points|default:0 }}</small>
                            {% endif %}
                        </div>
                        <a href="{% url 'survey:survey_landing' token=current_invitation.token %}" class="btn btn-primary btn-lg">
                            {% if current_invitation.status == 'submitted' %}
                                <i class="bi bi-pencil"></i> Edit Survey
                            {% elif current_invitation.status == 'in_progress' %}
                                <i class="bi bi-arrow-right"></i> Continue
                            {% else %}
                                <i class="bi bi-play-fill"></i> Start Survey
                            {% endif %}
                        </a>
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        You don't have an invitation for this campaign yet. Please contact the department administrator.
                    </div>
                {% endif %}
            </div>
            {% else %}
            <div class="alert alert-info mb-4">
                <i class="bi bi-info-circle"></i>
                <strong>No active survey</strong> - There is no survey campaign currently open.
                You'll be notified when the next survey period begins.
            </div>
            {% endif %}

            <!-- Past Submissions -->
            <h5 class="mb-3"><i class="bi bi-clock-history"></i> Past Submissions (AY {{ academic_year.year_code }})</h5>

            {% if past_submissions %}
            <div class="card">
                <div class="card-body p-0">
                    {% for inv in past_submissions %}
                    <div class="past-survey-item">
                        <div>
                            <strong>{{ inv.campaign.name }}</strong>
                            <br>
                            <small class="text-muted">Submitted {{ inv.submitted_at|date:"M j, Y" }}</small>
                        </div>
                        <div class="text-end">
                            <span class="status-badge status-submitted">Submitted</span>
                            {% if inv.response %}
                            <div class="small text-muted mt-1">{{ inv.response.total_points }} pts</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <p class="text-muted">No past submissions for this academic year.</p>
            {% endif %}
        </div>

        <div class="portal-footer">
            <p class="text-muted small mb-2">
                <i class="bi bi-bookmark"></i> Bookmark this page - your personal link never changes
            </p>
            <p class="text-muted small mb-0">
                UNMC Department of Anesthesiology | Academic Achievement Survey
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
