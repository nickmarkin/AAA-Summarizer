{% extends 'base.html' %}
{% load survey_tags %}

{% block title %}Faculty Roster - Academic Achievement Summarizer{% endblock %}

{% block page_title %}Faculty Roster{% endblock %}

{% block content %}
<h1>Faculty Roster</h1>

<div class="actions">
    <a href="{% url 'import_roster' %}" class="btn">Import from CSV</a>

    <form method="get" style="display: inline-block; margin-left: 20px;">
        <select name="division" onchange="this.form.submit()">
            <option value="">All Divisions</option>
            {% for value, label in division_choices %}
            <option value="{{ value }}" {% if value == current_division %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>

        <select name="rank" onchange="this.form.submit()">
            <option value="">All Ranks</option>
            {% for value, label in rank_choices %}
            <option value="{{ value }}" {% if value == current_rank %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>

        <select name="contract" onchange="this.form.submit()">
            <option value="">All Contract Types</option>
            {% for value, label in contract_choices %}
            <option value="{{ value }}" {% if value == current_contract %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>

        <label style="margin-left: 15px;">
            <input type="checkbox" name="ccc" value="1" {% if ccc_only %}checked{% endif %} onchange="this.form.submit()">
            CCC Members Only
        </label>
    </form>
</div>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Rank</th>
            <th>Contract</th>
            <th>Division</th>
            <th>CCC</th>
            {% if current_campaign %}<th>Survey</th>{% endif %}
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for f in faculty %}
        <tr>
            <td><a href="{% url 'faculty_detail' f.email %}">{{ f.display_name }}</a></td>
            <td>{{ f.email }}</td>
            <td>{{ f.get_rank_display|default:"-" }}</td>
            <td>{{ f.get_contract_type_display|default:"-" }}</td>
            <td>{{ f.get_division_display|default:"-" }}</td>
            <td>
                {% if f.is_ccc_member %}
                <span class="badge badge-info">CCC</span>
                {% endif %}
            </td>
            {% if current_campaign %}
            <td>
                {% with status=invitation_status|default_if_none:""|get_item:f.id %}
                    {% if status == 'submitted' %}
                        <span class="badge badge-success">Submitted</span>
                    {% elif status == 'in_progress' %}
                        <span class="badge badge-warning">In Progress</span>
                    {% elif status == 'pending' %}
                        <span class="badge badge-secondary">Pending</span>
                    {% else %}
                        <span class="badge badge-danger">No Invite</span>
                    {% endif %}
                {% endwith %}
            </td>
            {% endif %}
            <td>
                <a href="{% url 'faculty_edit' f.email %}">Edit</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="{% if current_campaign %}8{% else %}7{% endif %}" style="text-align: center; color: #666;">
                No faculty found. <a href="{% url 'import_roster' %}">Import roster from CSV</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p style="color: #666; font-size: 14px;">{{ faculty|length }} faculty members</p>
{% endblock %}
